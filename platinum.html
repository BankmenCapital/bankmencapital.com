<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bankmen Platinum Access</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/@solana/web3.js@1.91.3/lib/index.iife.min.js"></script>
  <style>
    body {
      background-color: #0a0a0a;
      color: #e5e5e5;
      font-family: 'Inter', sans-serif;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .fade-in {
      animation: fadeIn 0.7s ease forwards;
    }
    @keyframes fadeIn {
      from {opacity: 0; transform: translateY(10px);}
      to {opacity: 1; transform: translateY(0);}
    }
  </style>
</head>
<body>
  <div id="app" class="w-full flex justify-center items-center">
    <div id="connect-section" class="text-center">
      <h1 class="text-3xl font-bold mb-6">Bankmen Platinum Access</h1>
      <button id="connectButton" class="px-6 py-3 bg-yellow-500 text-black font-bold rounded-xl hover:bg-yellow-400 transition">
        Connect Wallet
      </button>
      <p id="status" class="mt-4 text-gray-400"></p>
    </div>

    <div id="dashboard" class="hidden fade-in">
      <div class="max-w-3xl mx-auto text-center">
        <h1 class="text-4xl font-bold mb-6 text-yellow-400">üè¶ Bankmen Platinum</h1>
        <p id="walletAddress" class="text-gray-400 mb-4"></p>
        <div class="bg-neutral-900 rounded-2xl p-6 shadow-lg mb-6">
          <h2 class="text-2xl font-semibold mb-2">Your XP</h2>
          <p class="text-4xl font-bold text-yellow-400" id="xp">0</p>
        </div>
        <div class="bg-neutral-900 rounded-2xl p-6 shadow-lg mb-6">
          <h2 class="text-2xl font-semibold mb-4">Your Bankmen NFTs</h2>
          <div id="nftGrid" class="grid grid-cols-2 md:grid-cols-3 gap-4"></div>
        </div>
        <div class="bg-neutral-900 rounded-2xl p-6 shadow-lg">
          <h2 class="text-2xl font-semibold mb-4">Season 1 - Coming Soon</h2>
          <div class="grid grid-cols-4 gap-3">
            <div class="p-4 border border-neutral-700 rounded-lg text-gray-500">üîí</div>
            <div class="p-4 border border-neutral-700 rounded-lg text-gray-500">üîí</div>
            <div class="p-4 border border-neutral-700 rounded-lg text-gray-500">üîí</div>
            <div class="p-4 border border-neutral-700 rounded-lg text-gray-500">üîí</div>
            <div class="p-4 border border-neutral-700 rounded-lg text-gray-500">üîí</div>
            <div class="p-4 border border-neutral-700 rounded-lg text-gray-500">üîí</div>
            <div class="p-4 border border-neutral-700 rounded-lg text-gray-500">üîí</div>
            <div class="p-4 border border-neutral-700 rounded-lg text-gray-500">üîí</div>
          </div>
        </div>
      </div>
    </div>
  </div>

<script>
const COLLECTION_ADDRESS = "GPtMdqNwNFnZGojyxEseXviJUZiqHyHDzWySjSHFup7J";
const UPDATE_AUTHORITY = "4A644enxADhwaMGsXL4zngnfT2kXRQMjubtQFFrGQb7T";
const SOLANA_RPC = "https://api.mainnet-beta.solana.com";

const connectButton = document.getElementById("connectButton");
const dashboard = document.getElementById("dashboard");
const connectSection = document.getElementById("connect-section");
const status = document.getElementById("status");
const nftGrid = document.getElementById("nftGrid");
const walletAddressEl = document.getElementById("walletAddress");

async function connectWallet() {
  if (!window.solana || !window.solana.isPhantom) {
    alert("Please install Phantom wallet.");
    return;
  }

  try {
    const resp = await window.solana.connect();
    const wallet = resp.publicKey.toString();
    walletAddressEl.textContent = "Wallet: " + wallet;
    status.textContent = "Checking NFT ownership...";

    const ownsNFT = await verifyOwnership(wallet);
    if (ownsNFT) {
      status.textContent = "";
      connectSection.classList.add("hidden");
      dashboard.classList.remove("hidden");
      await window.solana.signMessage(new TextEncoder().encode("I verify my wallet as a Bankmen Capital holder."));
    } else {
      status.textContent = "‚ùå Not a verified Bankmen holder.";
    }
  } catch (err) {
    console.error("Error:", err);
    status.textContent = "Connection or verification failed.";
  }
}

async function verifyOwnership(walletAddress) {
  const connection = new solanaWeb3.Connection(SOLANA_RPC);
  const owner = new solanaWeb3.PublicKey(walletAddress);

  // Fetch all token accounts for the wallet
  const tokenAccounts = await connection.getParsedTokenAccountsByOwner(owner, { programId: solanaWeb3.TOKEN_PROGRAM_ID });

  let found = false;
  for (let acc of tokenAccounts.value) {
    const amount = acc.account.data.parsed.info.tokenAmount;
    if (amount.amount === "1" && amount.decimals === 0) {
      const mint = acc.account.data.parsed.info.mint;
      const metadataPDA = await solanaWeb3.PublicKey.findProgramAddress(
        [
          Buffer.from("metadata"),
          new solanaWeb3.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s").toBuffer(),
          new solanaWeb3.PublicKey(mint).toBuffer(),
        ],
        new solanaWeb3.PublicKey("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s")
      );

      const accInfo = await connection.getAccountInfo(metadataPDA[0]);
      if (accInfo) {
        const metadata = accInfo.data.toString("utf8");
        if (metadata.includes(COLLECTION_ADDRESS) || metadata.includes(UPDATE_AUTHORITY)) {
          found = true;
          const jsonMatch = metadata.match(/https?:\/\/[^\s"]+/);
          if (jsonMatch) {
            try {
              const res = await fetch(jsonMatch[0]);
              const json = await res.json();
              if (json.image) {
                const img = document.createElement("img");
                img.src = json.image;
                img.className = "rounded-xl border border-neutral-700 shadow";
                nftGrid.appendChild(img);
              }
            } catch (e) { console.warn("Image load fail"); }
          }
        }
      }
    }
  }
  return found;
}

connectButton.addEventListener("click", connectWallet);
</script>
</body>
</html>
